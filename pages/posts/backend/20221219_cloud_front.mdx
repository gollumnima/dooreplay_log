---
title: 'Cloud Front와 S3 버킷을 이용한 정적블로그 올리기'
date: 'December 19, 2022'
description: '다음번 TODO로 남겨두었던 Cloud Front를 이렇게 벌써 쓰게될 줄이야'
thumbnail: ''
---

### Cloud Front가 왜 필요한지 몰랐는데..
어제 배포하고 기분 좋아서 블로그 주소를 다시 입력해봤는데.. 주의요함이 선명하게 주소창을 핥고 있었다.

분명 GitHub Page로 배포했을때는 HTTPS로 접속이 가능했는데.....

그렇다... 어제 배포로 내 블로그는 SSL 인증을 받지 않은 위험한 사이트가 된것이다.
<br />
(ALT: 대충 이빨 없는 빨강티 입은 외국인 남자애가 눈 동그랗게 뜨고 아하 하는 짤)

<a href='https://us-east-1.console.aws.amazon.com/acm/home?region=us-east-1#/welcomehttps://aws.amazon.com/ko/certificate-manager/'>AWS ACM</a>으로 접속해준다. 여기서 ACM은 Amazon Certifiacate Manager의 약자로, AWS에서 제공하는 SSL 인증서를 발급해주는 서비스이다.
여기서 SSL 인증서를 요청해보자!!
<br />
### ACM으로 SSL 인증서 발급하기
- 자동으로 버지니아 북부로 지역이 설정될텐데 혹시 지역이 다르다면 지역을 버지니아 북부로 바꿔준다.
- 도메인 이름 잘 입력하기
  - 나는 모든 서브 도메인을 포함한 내 도메인에 적용하기 위해 `*.dooreplay.com`라고 설정해두었다.
- 나머지는 모두 디폴트 권장사항으로 설정 끝~

버튼 한번이면 만들 수 있는건줄 알았는데 해당 도메인에 대해 검증 대기중이라 떠서 조금 기다려줘야 한다.

분명 어떤 블로그에서 30분만 기다리면 된다고 했는데.. 
그 사이에 폼롤러로 운동도 하고 캔디크러쉬도 다섯판이나 하고 왔는데도 아직 검증 대기중인 상태이다.

<br />
(하루가 지나고 초록딱지 인증서 발급 완료!)
<br />
### Cloud Front에 SSL 인증서 적용하기
<a href='https://us-east-1.console.aws.amazon.com/cloudfront/v3/home?region=us-east-1#/welcome'>Cloud Front</a>에 접속해서 배포를 생성해보자!
- 원본 도메인은 select box에서 내가 설정한 서브도메인으로 고고..!
- S3 버킷 액세스는 원본 액세스 제어 설정으로 고고.. 왜냐 권장이니까!!
  - 21년도 블로그 글들은 OAI 생성하는 걸로 되어있던데..
  - 아니 1년 사이에 Legacy가 붙는 설정값이 되다니 세월이란 참 야속해!
- Origin Shield 활성화도 예로 선택
  - 나는 한국에 있으니까 리전 선택은 서울로 고고
  - 캐싱 정책을 하나 더 추가해서 오리진 서버 부하를 줄여줄 수 있다고 하넹..!
  - 근데 활성화 하면 원본에 연결 시도할때마다 돈이 더 나올 수 있다고 하네..?!! 코베일거 같다 무서운 아마존..
- 대체 도메인 이름(CNAME)은 `blog.dooreplay.com`으로 설정해주었다.
- 그 아래 SSL은 어제 인증딱지 받은 고놈으로..! 
- 나머지는 권장사항이거나 기본 체크된 값으로 설정했다.

<br />
### 설정을 마쳤으니 https가 붙은 주소로 접속해보자!
먼저 상단에 있는 내가 설정한 커스텀 도메인 말고 배포 도메인 이름의 우스꽝스러운 주소로 접속을 해보았는데..
Access Denied.....?! 뭐지..?!... 좋아.. 거절할 수 없게 만들어주겠어..!
<br />
- 일단 클라우드 프론트 원본 편집 클릭해서 S3 버킷 액세스 하단의 정책복사 버튼 클릭클릭
- S3 버킷에서 내가 만든 도메인 이름의 버킷을 선택하고 권한탭을 클릭클릭
- 버킷 정책 편집을 클릭해 복사한 코드를 붙여준다.

+ 추가로..
Route53에 가서 내가 설정한 호스팅영역 들어가서 트래픽 라우팅 대상을 클라우드 프론트로 바꿔줘야 함!
<br />
근데 이게 문제가 아니라는 걸 깨달았다.
그래서 차근차근 <a href='https://aws.amazon.com/ko/premiumsupport/knowledge-center/s3-website-cloudfront-error-403'>공식문서</a>를 다시 읽어보았는데..<br />
기본 루트 객체에 `index.html`을 입력해야 한다는 사실을 깨닫고 입력해주니 정상적으로 접속이 되었다!
<br />
이제 나도 자물쇠 달린 안전한 사이트가 생겼다! 오예!
<br />

### NEXT TODO..?
- 배포 커맨드 수정해서 CI/CD 자동화 하기
- 블로그 메타태그 관리하기
- 블꾸 챌린지